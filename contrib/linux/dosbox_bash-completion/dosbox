# dosbox(1) completion
# vim: st=2:sw=2:et:ai:ft=bash

_dosbox()
{
  local cur prev words cword split
  _init_completion -s || return
  # see:
  #     declare -f _init_completion

  case "$prev" in
      -editconf)
        _list_native_programs get_editors
        return;;
      -opencaptures)
        _list_native_programs get_view_media
        return;;
  esac

  _exclusive_opt_check ||
  case "$cur" in
    -*)
        _dosbox_options
        return;;
     *)
        # hint at "-"
        # <dir|dos_exe(s)>
        return;;
  esac
}
_exclusive_opt_check()
{
  local _exclusive_opts
  _exclusive_opts="-(version|opencaptures|(print|erase|reset|edit)(conf|mapper))"
  # There is no -printmapper, but if there were I guess it would be exclusive.

  [[ ${words[1]} =~ ^$_exclusive_opts$ ]]
  return
}
_list_native_programs()
{
  local -n _prog_type=$1
  local -a get_editors=( $EDITOR vim nano )
  local -a get_view_media=( $BROWSER firefox mpv pcmanfm pcmanfm-qt )
  #TODO populate above with suitable programs
  local prog
  COMPREPLY=($( compgen -W '$( type -P "${_prog_type[@]}")' -- $cur ))
  return
}
_dosbox_options()
{
  COMPREPLY=($(
    compgen -W '
      -fullscreen
      -startmapper
      -noautoexec
      -securemode
      -userconf
      -scaler_scaler
      -forcescaler_scaler
      -conf_configfile
      -lang_langfile
      -machine_machinetype
      -socket_socketnumber
      -c_command
      -exit
      __file_exe_bat_dir
      ' -- $cur ))

  # The below are exclusive options
  # ignore them if other flags given earlier
  [[ $cword -gt 1 ]] ||
  COMPREPLY+=($(
    compgen -W '
      -version
      -editconf
      -opencaptures
      -printconf
      -eraseconf
      -resetconf
      -erasemapper
      -resetmapper
      ' -- $cur ))
  return
}
###
#   _* suffix is just placeholder, so I don't forget they need a new lising.
###
# __file__ could be .exe, .bat, .com, or a dir
# I guess the dir should be at populated
# Unless a floppy/cd is to be mounted
# can it appear anywhere or must it be last?
# I'm over thinking that right now, move on...
###
# -c, can be repeated..
# this one will be fun to populate, start with just the basics
###
# -conf can be repeated,
# -userconf, only once? it is godlike in anycase.
# both should be followed by a file (.conf)
###
# -forcescaler , once and should also hide -scaler
###



complete -F _dosbox fake_dosbox
#FIXME fake_dosbox just for testing, strip fake_

# 
# from man via (COLUMNS=9001 man dosbox | sed -E "s/^[ ]+( dosbox [[-][^ ].+)/#\1/p" -n )

# dosbox [-fullscreen] [-startmapper] [-noautoexec] [-securemode] [-userconf] [-scaler scaler] [-forcescaler scaler] [-conf configfile] [-lang langfile] [-machine machinetype] [-socket socketnumber] [-c command] [-exit] [file]
# dosbox -version
# dosbox -editconf program
# dosbox -opencaptures program
# dosbox -printconf
# dosbox -eraseconf
# dosbox -resetconf
# dosbox -erasemapper
# dosbox -resetmapper
